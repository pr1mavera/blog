---
title: 华夏官微用户行为收集接入手册
date: 2019-11-04
tags: 
 - 文档
---

## 接入流程

1. 与系统管理员联系，提供需要接入系统的相关信息，[详情](#获取接入权限)
2. 引入[jssdk](接入jssdk)，并在项目合适的时机初始化脚本
3. 登录[行为数据平台](#行为数据平台)，配置需要记录的行为数据埋点

## 获取接入权限

接入本系统需向系统管理员提供以下信息: 
1. 应用名称
2. 系统名称
3. 系统首页地址

## 接入jssdk

脚本临时地址: [https://sales-dev.ihxlife.com/video/hx-analytics/jssdk/hx-analytics.js](https://sales-dev.ihxlife.com/video/hx-analytics/jssdk/hx-analytics.js)

1. 引入脚本

    引入方式目前仅支持标签引入，后续会考虑支持 npm 包引入
    ``` html
    ...
    <!-- 在文档头部引入临时 cdn 地址 -->
    <script>
        var ha = ha || [];
        (function () {
            var ha = document.createElement('script');
            ha.type = 'text/javascript';
            ha.async = true;
            // uat 版本，带 source map ，建议调试阶段尽量使用该版本
            ha.src = 'https://sales-dev.ihxlife.com/video/hx-analytics/jssdk/hx-analytics.js';
            // or 生产版本 
            // ha.src = 'https://sales.ihxlife.com/video/hx-analytics/jssdk/hx-analytics.umd.min.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ha, s);
        })();
    </script>
    ...
    ```

2. 传入行为数据收集模块初始化指令

    在引入脚本之后的任意位置，初始化行为数据收集模块
    ``` js
    // 从某个API拿到 jssdk 初始化的相关依赖: appId / sysId / openId
    getDataFromSomeAPI().then(data => {
        // ha.push([ direction: string, ...args?: Array<any> ]): void;
        // args 顺序 appId, sysId, openId  暂时按照该格式传入
        // 后续会将文档补充完整
        ha.push([ 'init', 'kzgm', 'kfxt', 'oKXX7wKQhDf0sixuV0z-gEB8Y8is' ]);
    })
    ```

    初始化完成之后，收集模块将自动收集用户行为的全量日志

## 行为数据平台

平台地址: [https://video-uat.ihxlife.com/event/home](https://video-uat.ihxlife.com/event/home)

### 配置埋点

+ 入口: 
    1. `/setting/index` 埋点配置页面，直接输入url，进入页面配置
    2. `/dots/versions` 版本查询列表页，查询到相关系统版本，进入指定版本的页面配置

+ 配置流程:
    1. 登录系统，选择相关应用下的页面系统，点击搜索
    2. 点击切换至配置模式，若该页面引入了jssdk并成功初始化行为收集模块，则可开启配置模式
    3. 通过鼠标滑动捕获dom元素，会以 **`蓝色`** 高亮显示出来，点击即可选中元素，同时右侧配置栏会将元素信息展示出来，可根据需要配置相关信息  
        注：若当前页面存在之前配置过的埋点，将会以 **`红色`** 高亮显示出来
    4. 配置完成后点击提交，即可添加一条埋点记录

### 系统埋点版本查询

+ 入口: `/dots/versions`
+ 查询指定应用、系统，下的版本列表

### 埋点查询

+ 入口: `/dots/list`
+ 根据条件查询埋点数据
