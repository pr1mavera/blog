---
title: NodeJS常用API
date: 2019-06-24
tags: 
 - 阿灯
---

## 一个最基本的web服务
```js
var http = require('http');

http.createServer(function () {
    // 定义HTTP头
    res.writeHead(200, {'Content-type': 'text/plain'});

    // 发送相应数据
    res.end('Hello world!\n');
}).listen(8000);

console.log('server is runing in port 8000...');
```

## 阻塞代码 & 非阻塞代码
```js
// 阻塞
var fs = require('fs');
var data = fs.readFileSync('data.txt');
console.log(data.toString());
```
```js
// 非阻塞
var fs = require('fs');
fs.readFile('data.txt', function (err, data) {
    if (err) {
        return console.error(err);
    }
    console.log(data.toString());
});
```

## 事件驱动
![事件驱动模型](/blog/img/yideng/event-loop.jpg)

## 事件处理代码流程
1. 引入event对象，创建eventEmitter对象
2. 绑定事件处理程序
3. 触发事件

```js
// 1. 引入event对象，创建eventEmitter对象
var events = require('events');
var eventEmitter = new events.EventEmitter();

// 2. 绑定事件处理程序
var connectHandler = function connected () {
    console.log('触发了connected方法');
}

eventEmitter.on('connection', connectHandler);

// 3. 触发事件
eventEmitter.emit('connection');
```

## 模块化
### 意义
+ 为了让Node.js的文件可以相互调用，Node.js提供了一个简单的模块系统
+ 模块是Node.js应用程序的基本组成部分
+ 文件和模块是一一对应的，一个Node.js文件就是一个模块
+ 这个文件可能是JavaScript代码、json或者编译过的C / C++扩展
+ Node.js中存在4类模块：原生模块和3种文件模块

### 加载流程
+ 从文件模块缓存中加载
+ 从原生模块加载
+ 从文件加载
![模块加载流程](/blog/img/yideng/modules-load.png)

### require加载模块
require方法接受以下几种参数的传递：
+ `http`、`fs`、`path` 等，原生模块
+ `./mod` 或者 `../mod`，相对路径的文件模块
+ `/pathtomodule/mod`，绝对路径的文件模块
+ mod，非原生模块的文件模块