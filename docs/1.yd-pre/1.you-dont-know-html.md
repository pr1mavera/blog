---
title: 你不知道的HTML
date: 2019-06-18
tags: 
 - 阿灯
---

## 同源策略
含义：
+ 协议相同
+ 域名相同
+ 端口相同

同源策略目的： **为了保证用户信息的安全，防止恶意的网站窃取数据。**

同源策略限制范围：（跨域）
+ Cookie、LocalStorage 和 IndexDB 无法读取
+ DOM 无法获得
+ AJAX 请求不能发送

## 跨域方案
html标签：img iframe script(jsonp) link(background)

## domain
Cookie 是服务器写入浏览器的一小段信息，只有同源的网页才能共享。但是，两个网页一级域名相同，只是二级域名不同，浏览器允许通过设置 `document.domain` 共享 Cookie。

例子：
+ A网页：www.baidu,com/a.html 设置了 `document.domain = 'abc'`
+ B网页：www.baidu,com/b.html 设置了 `document.domain = 'abc'`

此时A网页设置的 `document.cookie = '3n89f34'` ，也可以在B网页获取到

::: warning 注意：
这种方法只适用于 Cookie 和 iframe 窗口，LocalStorage 和 IndexDB 无法通过这种方法，规避同源政策，而要使用下文介绍的PostMessage API
:::

另外，服务器也可以在设置Cookie的时候，指定Cookie的所属域名为一级域名，比如：
```
Set-Cookie: key=value; domain=abc; path=/
```

### 如何设置同源策略（hosts）
test.xxx.com a.html
```html
<script>
    document.domain = 'abc' // 设置同源策略
    document.cookie = '3n89f34'
</script>

```

test.xxx.com a.html
```html
<script>
    document.cookie // 3n89f34
</script>
```

最常用的策略：**由服务端设置 `cookie` 的 `domain`**

## 标签跨域
+ script
+ img
+ iframe
+ link

### 提交表单
::: warning 注意：
浏览器不同域名不能访问对应的cookie，但是网页内部的表单没有限制
:::
例子：
```html
<!-- 在 www.baidu,com 可以存在访问 www.sssbbb.com 的表单 -->
<form action="http://www.sssbbb.com">
    <input type="text">
    <input type="submit">
</form>
```

## jsonp
在 www.baidu,com 里请求的资源类似于   
```html
<script src="http://www.sssbbb.com/index.php?callback=test"></script>
```
则需要在 www.sssbbb.com/index.php 中指定页面中执行的回调
```js
if (query.callback) {
    query.callback({ data: '123' })
} else {
    { data: '123' }
}
```
在页面中需要指定这样的方法：
```js
function test (data) {
    console.log(data) // 123
}
```

## 高阶的跨域
+ postMessage
```js
var popup = window.open('http://bbb.com', 'title')
popup.postMessage('Hello World!', 'http://bbb.com')
```
+ WebSocket，可以设置对应的 `Origin`
+ 将代码写到img中，利用base64

## html语义化
多数情况下div和span够用，也提倡使用，同时如果能做到合理运用语义化则更便于人阅读，也便于机器阅读
::: warning 注意：
尽量只用自己熟悉的语义标签，并且只在有把握的场景引入语义标签。这样，我们才能保证语义标签不被滥用，造成更多的问题
:::

### 作为自然语言延伸的语义类标签
`ruby` 、 `rt` 、 `rp` ，在一定的语句中用于解释说明用

![ruby语义](/blog/img/yideng/ruby-yuyi.png)

### 表示一些特定语义
`em` 、 `strong` ，em通常在一句话中用于表达特定的语义，em位置不同，表达的句意也不一样。strong只单纯表示强调

### 作为标题摘要的语义类标签
+ hgroup 避免副标题产生额外的一个层级
+ section 的嵌套会使得其中的 h1-h6 下降一级

### 作为整体结构的语义类标签
```html
<body>
    <header>
        <nav>
            ……
        </nav>
    </header>
    <aside>
        <nav>
            ……
        </nav>
    </aside>
    <section>……</section>
    <section>……</section>
    <section>……</section>
    <footer>
        <address>……</address>
    </footer>
</body>
```
article 是一种特别的结构，它表示具有一定独立性质的文章。article 和 body 具有相似的结构，同时，一个 HTML 页面中，可能有多个 article 存在。
```html
<body>
    <header>……</header>
    <article>
        <header>……</header>
        <section>……</section>
        <section>……</section>
        <section>……</section>
        <footer>……</footer>
    </article>
    <article>
        ……
    </article>
    <article>
        ……
    </article>
    <footer>
        <address></address>
    </footer>
</body>
```
### 意义
1. 在没有 CSS 的时候，开发者也能够清晰地看出网页的结构，增强了可读性
2. 便于团队的开发和维护
3. 让浏览器更好的理解标签
4. 适合搜索引擎检索（SEO）
5. 让爬虫刚好的理解文章的意思
6. 语义类还可以支持读屏软件，根据文章可以自动生成目录

::: warning 注意：
尽量少写html标签：（一个标签利用上 `before` 、 `after` 至少可以代替三个）。作用：
1. 减少dom渲染时间
2. 不浪费整个文件大小
:::

