<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js执行过程 | pr1mavera&#39;s blog</title>
    <meta name="description" content="一切不成体系的知识碎片都只能当做无聊的消遣">
    <link rel="icon" href="/blog/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/blog/assets/css/0.styles.c868d9db.css" as="style"><link rel="preload" href="/blog/assets/js/app.49d49959.js" as="script"><link rel="preload" href="/blog/assets/js/3.66f9ff46.js" as="script"><link rel="preload" href="/blog/assets/js/1.0064e023.js" as="script"><link rel="preload" href="/blog/assets/js/18.d105b441.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.b17e6a5b.js"><link rel="prefetch" href="/blog/assets/js/11.96a9f392.js"><link rel="prefetch" href="/blog/assets/js/12.0c07436c.js"><link rel="prefetch" href="/blog/assets/js/13.f37a0d7c.js"><link rel="prefetch" href="/blog/assets/js/14.0f2ed949.js"><link rel="prefetch" href="/blog/assets/js/15.b12c037c.js"><link rel="prefetch" href="/blog/assets/js/16.f66ea695.js"><link rel="prefetch" href="/blog/assets/js/17.4d7c521c.js"><link rel="prefetch" href="/blog/assets/js/19.bc34f423.js"><link rel="prefetch" href="/blog/assets/js/20.fbfb45a4.js"><link rel="prefetch" href="/blog/assets/js/21.c225ceb5.js"><link rel="prefetch" href="/blog/assets/js/22.9e3a65c5.js"><link rel="prefetch" href="/blog/assets/js/23.9b2216aa.js"><link rel="prefetch" href="/blog/assets/js/24.4402665b.js"><link rel="prefetch" href="/blog/assets/js/25.e48768fc.js"><link rel="prefetch" href="/blog/assets/js/26.6e0c6af0.js"><link rel="prefetch" href="/blog/assets/js/27.f7355d0e.js"><link rel="prefetch" href="/blog/assets/js/28.1307c2eb.js"><link rel="prefetch" href="/blog/assets/js/29.97e9b0fc.js"><link rel="prefetch" href="/blog/assets/js/30.11d799d8.js"><link rel="prefetch" href="/blog/assets/js/31.6226632e.js"><link rel="prefetch" href="/blog/assets/js/32.51037068.js"><link rel="prefetch" href="/blog/assets/js/33.8ea562c0.js"><link rel="prefetch" href="/blog/assets/js/34.d9b383be.js"><link rel="prefetch" href="/blog/assets/js/35.6f4fcdb2.js"><link rel="prefetch" href="/blog/assets/js/36.2de9d1e5.js"><link rel="prefetch" href="/blog/assets/js/37.1aa09447.js"><link rel="prefetch" href="/blog/assets/js/38.2571463d.js"><link rel="prefetch" href="/blog/assets/js/39.2f9cc2fd.js"><link rel="prefetch" href="/blog/assets/js/4.69c4a582.js"><link rel="prefetch" href="/blog/assets/js/40.7903fce3.js"><link rel="prefetch" href="/blog/assets/js/41.898fdea0.js"><link rel="prefetch" href="/blog/assets/js/42.59061c98.js"><link rel="prefetch" href="/blog/assets/js/43.db1479b9.js"><link rel="prefetch" href="/blog/assets/js/44.0670a23d.js"><link rel="prefetch" href="/blog/assets/js/45.e50482d5.js"><link rel="prefetch" href="/blog/assets/js/46.0d2d191b.js"><link rel="prefetch" href="/blog/assets/js/47.e70cbf71.js"><link rel="prefetch" href="/blog/assets/js/48.43575794.js"><link rel="prefetch" href="/blog/assets/js/49.d7b305be.js"><link rel="prefetch" href="/blog/assets/js/5.0fe73cb2.js"><link rel="prefetch" href="/blog/assets/js/50.d316483b.js"><link rel="prefetch" href="/blog/assets/js/51.9b9c860a.js"><link rel="prefetch" href="/blog/assets/js/52.34197678.js"><link rel="prefetch" href="/blog/assets/js/53.a112b976.js"><link rel="prefetch" href="/blog/assets/js/54.c0237cb5.js"><link rel="prefetch" href="/blog/assets/js/55.b18fd02a.js"><link rel="prefetch" href="/blog/assets/js/56.6e8b568a.js"><link rel="prefetch" href="/blog/assets/js/57.bc78fd12.js"><link rel="prefetch" href="/blog/assets/js/58.fb2f70c7.js"><link rel="prefetch" href="/blog/assets/js/6.0b6b04a3.js"><link rel="prefetch" href="/blog/assets/js/7.583d1c85.js"><link rel="prefetch" href="/blog/assets/js/8.9b24f937.js"><link rel="prefetch" href="/blog/assets/js/9.34e66468.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.c868d9db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-ad130a7c><div data-v-ad130a7c><div id="loader-wrapper" class="loading-wrapper" data-v-4b73742e data-v-ad130a7c data-v-ad130a7c><div class="loader-main" data-v-4b73742e><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out is-home" style="display:none;" data-v-262b1d1e data-v-ad130a7c data-v-ad130a7c><h3 class="title" data-v-262b1d1e>pr1mavera's blog</h3> <p class="description" data-v-262b1d1e>一切不成体系的知识碎片都只能当做无聊的消遣</p> <label id="box" class="inputBox" data-v-262b1d1e><input type="password" value="" data-v-262b1d1e> <span data-v-262b1d1e>Konck! Knock!</span> <button data-v-262b1d1e>OK</button></label> <div class="footer" data-v-262b1d1e><span data-v-262b1d1e><i class="iconfont reco-theme" data-v-262b1d1e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-262b1d1e>vuePress-theme-reco</a></span> <span data-v-262b1d1e><i class="iconfont reco-other" data-v-262b1d1e></i> <a data-v-262b1d1e>pr1mavera</a></span> <span data-v-262b1d1e><i class="iconfont reco-copyright" data-v-262b1d1e></i> <a data-v-262b1d1e>2020</a></span></div></div> <div class="hide" data-v-ad130a7c><header class="navbar" data-v-ad130a7c><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/img/logo.png" alt="pr1mavera's blog" class="logo"> <span class="site-name">pr1mavera's blog</span></a> <div class="links"><!----> <div class="fullscreen-wrapper screenfull" data-v-669fca12><svg t="1574746366011" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5517" width="200" height="200" class="icon" data-v-669fca12><path d="M223.51420462 330.2102269h1.49573886c0 32.21590925 0.26846576 64.43181848-0.19176196 96.64772772-0.15340924 8.8977269 2.9914769 11.16051113 11.390625 10.96875 19.06107962-0.3835231 38.16051113-0.23011387 57.22159158 0.421875 8.24573887 0.26846576 10.9303981-2.30113613 10.6235788-10.62357962-0.76704538-19.67471576-0.65198887-39.38778425-0.84375-59.0625 0-2.0710231-0.65198887-4.6789769 1.87926197-5.82954538 2.5696019-1.15056848 3.8352269 1.2272731 5.40767037 2.60795462 1.15056848 1.03551113 2.22443152 2.18607962 3.33664728 3.29829538 35.09232962 35.0539769 70.26136387 70.03125 105.16193235 105.27698886 5.59943152 5.63778425 9.47301113 7.47869348 15.83948803 0.61363614 12.54119348-13.5 25.61931848-26.5397731 39.11931848-39.11931849 6.86505652-6.3664769 7.09517038-10.47017038 0.19176114-17.22017037-35.8210231-35.16903424-71.22017038-70.79829538-106.69602228-106.35085189-1.91761387-1.91761387-5.36931848-3.72017038-4.37215924-6.71164812 1.2272731-3.87357962 5.29261387-2.33948887 8.20738613-2.30113613 19.3678981 0.07670462 38.73579538 0.15340924 58.14204539 0.72869348 6.90340925 0.19176113 9.39630652-2.0710231 9.2428981-9.08948886-0.4602269-20.32670462-0.65198887-40.65340925-0.421875-60.98011386 0.07670462-7.1335231-2.76136387-9.01278424-9.47301114-9.05113614-65.31392038-0.30681848-130.66619348-0.76704538-195.98011386-1.53409076-7.74715924-0.11505652-9.47301113 2.68465925-9.43465924 9.81818152 0.30681848 32.484375 0.15340924 65.0071019 0.15340924 97.52982962m433.61079538 466.36363613l20.55681848 0.11505735c0.53693152 0.26846576 1.11221576 0.76704538 1.6875 0.76704538 37.43181848 0.26846576 74.90198887 0.421875 112.37215842 0.84375 6.25142038 0.07670462 7.09517038-3.06818152 7.05681848-8.16903424-0.30681848-23.77840924-0.23011387-47.48011387-0.69034076-71.18181849-0.26846576-14.65056848 1.11221576-29.30113613-0.92045462-43.875l-0.11505652-18.44744265c1.80255652-22.12926113 0.15340924-44.296875 0.53693152-66.42613697 0.11505652-5.5227269-3.14488613-6.7116481-7.86221575-6.71164726-21.24715925 0-42.49431848 0-63.74147773-0.38352312-5.9446019-0.11505652-7.5553981 2.41619348-7.44034077 7.82386387 0.26846576 16.22301113 0.23011387 32.484375 0.26846577 48.70738613v21.09375c-5.13920462-1.61079538-7.28693152-4.83238613-9.77982962-7.32528423-35.51420462-35.4758519-71.10511387-70.9133519-106.3508519-106.65767039-5.59943152-5.67613613-9.08948887-5.5227269-14.3821019 0-13.42329538 13.99857962-27.07670462 27.69034075-41.03693235 41.03693235-5.56107962 5.36931848-5.71448887 8.8210231-0.03835188 14.42045462 35.55255652 35.015625 70.75994348 70.37642038 105.96732961 105.73721577 2.68465925 2.68465925 6.51988613 4.71732962 7.32528342 9.28125-3.29829538 2.109375-6.7883519 1.15056848-10.04829538 1.15056765-19.40625 0-38.73579538-0.15340924-58.14204539-0.26846577-4.52556848 0-8.8210231-0.3835231-8.70596575 6.44318235 0.30681848 21.86079538 0.30681848 43.75994348 0.3835231 65.65909077 0 4.6022731 1.91761387 6.98011387 6.67329539 6.90340923 22.12926113-0.3835231 44.296875 1.265625 66.42613613-0.53693235M513.2272731 90.20170462c113.5227269 0 226.96875 0.11505652 340.453125-0.07670462 27.4602269-0.0383519 49.97301113 9.47301113 66.42613614 31.75568152 11.08380652 14.95738613 14.19034075 32.21590925 14.19034076 50.43323886-0.11505652 109.41903425-0.0383519 218.83806848-0.0383519 328.29545462 0 117.20454538-0.11505652 234.44744348 0.0767038 351.69034076 0.0383519 27.34517038-8.8977269 50.01136387-31.14204538 66.77130734-15.1875 11.50568152-32.59943152 14.765625-51.12357962 14.765625-127.8664769-0.07670462-255.73295462-0.0383519-383.59943152-0.03835272-98.79545462 0-197.59090924-0.15340924-296.38636386 0.07670462-27.72869348 0.07670462-50.6633519-9.12784076-67.34659077-31.83238613-11.0071019-14.95738613-14.19034075-32.13920462-14.15198885-50.43323887 0.11505652-141.59659076 0.07670462-283.23153424 0.07670462-424.8664769 0-85.33380652 0.11505652-170.66761387-0.07670462-256.0397731C90.5852269 143.28125 99.98153424 120.73011387 122.34090925 104.31534075c14.95738613-11.0071019 32.21590925-14.19034075 50.43323885-14.15198885 113.5227269 0.15340924 226.96875 0.07670462 340.453125 0.07670462" p-id="5518" data-v-669fca12></path></svg></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask" data-v-ad130a7c></div> <aside class="sidebar" data-v-ad130a7c><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>无聊的消遣</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/whatever/snabbdom源码分析.html" class="sidebar-link">snabbdom 源码分析</a></li><li><a href="/blog/whatever/客户行为收集sdk项目记录.html" class="sidebar-link">客户行为收集sdk项目记录</a></li><li><a href="/blog/whatever/记一次算法在前端的实际应用.html" class="sidebar-link">记一次算法在前端的实际应用</a></li><li><a href="/blog/whatever/对于MV*的理解.html" class="sidebar-link">对于MV*的理解</a></li><li><a href="/blog/whatever/cube-ui-“精致”的前端UI组件框架.html" class="sidebar-link">cube-ui - “精致”的前端UI组件框架</a></li><li><a href="/blog/whatever/华夏视频服务.html" class="sidebar-link">华夏视频服务</a></li><li><a href="/blog/whatever/RxJS的响应式原理.html" class="sidebar-link">RxJS的响应式原理</a></li><li><a href="/blog/whatever/可视化埋点JS-SDK技术方案.html" class="sidebar-link">可视化埋点JS-SDK技术方案</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机科学基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手写代码</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器原理及性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nodeJs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>函数式编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架与原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程实践</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-262b1d1e data-v-ad130a7c><h3 class="title" data-v-262b1d1e>js执行过程</h3> <!----> <label id="box" class="inputBox" data-v-262b1d1e><input type="password" value="" data-v-262b1d1e> <span data-v-262b1d1e>Konck! Knock!</span> <button data-v-262b1d1e>OK</button></label> <div class="footer" data-v-262b1d1e><span data-v-262b1d1e><i class="iconfont reco-theme" data-v-262b1d1e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-262b1d1e>vuePress-theme-reco</a></span> <span data-v-262b1d1e><i class="iconfont reco-other" data-v-262b1d1e></i> <a data-v-262b1d1e>pr1mavera</a></span> <span data-v-262b1d1e><i class="iconfont reco-copyright" data-v-262b1d1e></i> <a data-v-262b1d1e>2020</a></span></div></div> <div data-v-ad130a7c><main class="page reco-hide"> <div class="page-title"><h1>js执行过程</h1> <hr> <div data-v-7b49930f><i class="iconfont reco-account" data-v-7b49930f><span data-v-7b49930f>pr1mavera</span></i> <i class="iconfont reco-date" data-v-7b49930f><span data-v-7b49930f>2019/11/27</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="代码段"><a href="#代码段" class="header-anchor">#</a> 代码段</h2> <p>js 代码执行过程中，<strong>最大颗度</strong>的执行片段</p> <h3 id="宏任务"><a href="#宏任务" class="header-anchor">#</a> 宏任务</h3> <p>js 等待宿主环境分配宏任务，类似于一个在独立线程的 <code>while(TRUE)</code> 的循环，内部加上 <strong>判断循环是否结束、宏观任务队列</strong> 等逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r <span class="token operator">=</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">execute</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样的一次循环就对应着一次宏任务，引擎不断的判断当前任务队列中是否存在任务，一次次执行</p> <ul><li>宿主级别任务</li> <li>宏观任务的队列就相当于事件循环</li> <li>存在于宿主环境主线程中，代表一次 js 脚本的执行</li> <li>可以由宿主环境提供的API，调用产生新的宏任务</li></ul> <h3 id="微任务"><a href="#微任务" class="header-anchor">#</a> 微任务</h3> <p>每个宏任务中包含一个微任务队列，js引擎产生微任务添加至任务队列末尾</p> <ul><li>引擎级别任务</li> <li>存在于宏任务中，由 js引擎 提供的API产生</li> <li>微任务一定在下一个宏任务之前执行，换句话说：<strong>下一个宏任务执行之前会将上一个宏任务中的微任务全部执行完</strong></li></ul> <h3 id="比较"><a href="#比较" class="header-anchor">#</a> 比较</h3> <p>下一个宏任务执行之前会将上一个宏任务中的微任务全部执行完</p> <h4 id="分析异步执行的顺序"><a href="#分析异步执行的顺序" class="header-anchor">#</a> 分析异步执行的顺序</h4> <ol><li>首先我们分析有多少个<strong>宏任务</strong></li> <li>在每个<strong>宏任务</strong>中，分析有多少个<strong>微任务</strong></li> <li>根据调用次序，确定宏任务中的微任务<strong>执行次序</strong></li> <li>根据宏任务的触发规则和调用次序，确定宏任务的<strong>执行次序</strong></li> <li>确定整个顺序</li></ol> <h4 id="sleep"><a href="#sleep" class="header-anchor">#</a> sleep</h4> <p>常用的程序休眠工具函数</p> <ol><li>同步休眠
<ul><li>js主线程休眠，全局休眠，会同时阻塞 GUI</li> <li>通过循环阻塞当前主线程实现休眠</li> <li>所有异步任务即使在休眠时期触发也被会被阻塞</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sleepSync</span> <span class="token operator">=</span> <span class="token parameter">delay</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start <span class="token operator">&lt;</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我想要引擎空闲就执行'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sleepSync</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 一秒之后打印 '我想要引擎空闲就执行'</span>
</code></pre></div></li> <li>异步休眠
<ul><li>只会阻塞当前宏任务</li> <li>将休眠后的代码作为宏任务添加进异步队列队尾</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token parameter">delay</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我想要引擎空闲就执行'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 立即打印 '我想要引擎空闲就执行'</span>
</code></pre></div></li></ol> <h4 id="一道有♂趣的面试题"><a href="#一道有♂趣的面试题" class="header-anchor">#</a> 一道有♂趣的面试题</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">var</span> begin <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 刻意构造一个阻塞，模拟一个 执行1秒 的微任务</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> begin <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;c1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;c2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 打印结果为 c1 c2 d</span>
</code></pre></div><h4 id="一道更有♂趣的面试题"><a href="#一道更有♂趣的面试题" class="header-anchor">#</a> 一道更有♂趣的面试题</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">LOG</span> <span class="token operator">=</span> console<span class="token punctuation">.</span>warn<span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">LOG</span><span class="token punctuation">(</span><span class="token string">'s0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">LOG</span><span class="token punctuation">(</span><span class="token string">'s1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">LOG</span><span class="token punctuation">(</span><span class="token string">'s2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">LOG</span><span class="token punctuation">(</span><span class="token string">'s3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">LOG</span><span class="token punctuation">(</span><span class="token string">'s4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token constant">LOG</span><span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">LOG</span><span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">LOG</span><span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> n <span class="token operator">+</span> start<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 打印结果为 S2 S0 8 6 7 S3 S4 S1</span>
</code></pre></div><h2 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h2> <p>js 代码执行过程中，<strong>函数颗度</strong>的执行片段</p> <h3 id="函数执行过程术语"><a href="#函数执行过程术语" class="header-anchor">#</a> 函数执行过程术语</h3> <ul><li><strong>闭包</strong> <ul><li><code>Closure</code></li> <li>官方：一个绑定了执行环境的函数</li> <li>白话：使用了本不该使用的变量的函数，函数所需的 <strong>作用域链</strong> 的持久化的快照</li> <li>保存在堆内存中</li></ul></li> <li><strong>作用域</strong> <ul><li><code>Scope</code></li> <li><em>Global Scope</em> - 全局作用域</li> <li><em>Function Scope</em> - 函数作用域</li> <li><em>Block Scope</em> - 块级作用域（ES6+）</li></ul></li> <li><strong>执行上下文</strong> <ul><li><code>Execution Context</code>，<code>EC</code></li> <li>执行的基础设施</li></ul></li> <li><strong>调用栈</strong> <ul><li><code>Callback Stack</code></li> <li>函数调用时产生的进度信息</li> <li>当子函数结束时需要继续执行父函数后续过程</li></ul></li> <li><strong>执行上下文栈</strong> <ul><li><code>Execution Context Stack</code>，<code>ECS</code></li> <li>包含一组 <code>EC</code>，栈底永远是 <code>Global EC</code></li> <li>是 <code>Callback Stack</code> 背后的实际数据结构，用于过程管理</li></ul></li></ul> <h3 id="闭包-closure"><a href="#闭包-closure" class="header-anchor">#</a> 闭包 <code>Closure</code></h3> <h4 id="概念结构"><a href="#概念结构" class="header-anchor">#</a> 概念结构</h4> <div class="language-js extra-class"><pre class="language-js"><code>fn <span class="token punctuation">{</span>
    prototype<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        constructor<span class="token punctuation">:</span> fn<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 作用域链（解构就像正常执行时那样）</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>Scopes<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        Closure <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 闭包</span>
        Closure <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 根据作用域链的概念，可能存在多级闭包</span>
        <span class="token operator">...</span>
        Global <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>环境部分
<ul><li>环境：函数的词法环境（执行上下文的一部分）</li> <li>标识符列表：函数中用到的未声明的变量（本不该使用的那部分）</li></ul></li> <li>表达式部分：函数体</li></ul> <h3 id="执行上下文-ec"><a href="#执行上下文-ec" class="header-anchor">#</a> 执行上下文 <code>EC</code></h3> <h4 id="概念结构-2"><a href="#概念结构-2" class="header-anchor">#</a> 概念结构</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token constant">VO</span> <span class="token operator">/</span> <span class="token constant">AO</span>：<span class="token punctuation">{</span>
        arguments<span class="token operator">?</span><span class="token punctuation">:</span> ArrayLike<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>declarations<span class="token punctuation">]</span><span class="token punctuation">:</span> any<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>Scopes<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        Scope <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 父级作用域</span>
        Scope <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 多级父级作用域</span>
        <span class="token operator">...</span>
        Global <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 栈底是全局作用域</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="es3"><a href="#es3" class="header-anchor">#</a> ES3</h4> <ul><li>this - 当前 <code>EC</code> 的this指向</li> <li>作用域链 - <code>Scope Chain</code>，在浏览器中表现为 <code>[[Scopes]]：Array</code> ，定义为：Scope = AO | VO + [[Scope]] （活动对象添加到作用域链的前部）</li> <li>变量对象 - <code>Variable Object</code>，<code>VO</code>，每个 <code>EC</code> 的一部分，保存<strong>当前</strong> <code>EC</code> 中词法环境的变量
<ul><li>活动对象 - <code>Activation Object</code>，函数级执行上下文中的 VO（多了 arguments）</li> <li><code>__parent__</code> - 指向父级执行上下文的变量对象（<code>VO</code> | <code>AO</code>），在 <code>Global EC</code> 中为 null</li></ul></li></ul> <h4 id="es5"><a href="#es5" class="header-anchor">#</a> ES5</h4> <ul><li>词法环境 - <code>lexical environment</code>，当获取变量时使用</li> <li>变量环境 - <code>variable environment</code>，当声明变量时使用</li> <li>this - this 值</li></ul> <h4 id="es2018"><a href="#es2018" class="header-anchor">#</a> ES2018</h4> <ul><li>词法环境 - <code>lexical environment</code>，当获取变量时或者 this 值时使用</li> <li>变量环境 - <code>variable environment</code>，当声明变量时使用</li> <li>code evaluation state - 用于恢复代码执行位置</li> <li>Function - 执行的任务是函数时使用，表示正在被执行的函数</li> <li>ScriptOrModule - 执行的任务是脚本或者模块时使用，表示正在被执行的代码</li> <li>Realm - 使用的基础库和内置对象实例</li> <li>Generator - 仅生成器上下文有这个属性，表示当前生成器</li></ul> <h4 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h4> <ul><li><strong>Creation</strong> - <code>ECS</code> 入栈一个新 <code>EC</code> <ul><li>创建变量对象 <code>VO</code> | <code>AO</code>（预编译阶段）
<ul><li>创建 <code>arguments</code> 对象</li> <li><a href="#%E5%A3%B0%E6%98%8E%E6%8F%90%E5%8D%87">声明提升</a></li></ul></li> <li>创建作用域链 <code>[[Scopes]]：Array</code>，将当前 <code>VO</code> 与父级 <code>[[Scopes]]</code> 相连，作为当前 <code>EC</code> 作用域链</li> <li>创建this指向</li></ul></li> <li><strong>Execution</strong> - 代码执行
<ul><li>遵循 JavaScript <strong>中缀</strong>的语法顺序，详细移步 <a href="#%E8%AF%AD%E5%8F%A5">js语句级别执行</a></li> <li>变量 RHS 查找（找到内存中对应的值，用于值操作）规则：
<ol><li>查找当前 <code>VO</code> | <code>AO</code></li> <li>找不到则基于当前作用域链依次向上查找</li> <li>直到找到顶层 <code>Global VO</code> 还未找到，则报错</li></ol></li> <li>变量 LHS 查找（查找变量索引，用于赋值）规则：
<ol><li>查找当前 <code>VO</code> | <code>AO</code></li> <li>找不到则基于当前作用域链依次向上查找</li> <li>直到找到顶层 <code>Global VO</code> 还未找到，则在顶层 <code>Global VO</code> 创建同名变量，并作为查找结果返回</li></ol></li></ul></li> <li><strong>Finished</strong> - 执行结束，当前 <code>EC</code> 出栈
<ul><li>显式的 ReturnStatement 或隐式的 return undefined</li> <li>卸载当前上下文，可能产生闭包</li> <li><code>ECS</code> 退至上一级 <code>EC</code> 继续执行</li></ul></li></ul> <h4 id="与-script-标签的关系"><a href="#与-script-标签的关系" class="header-anchor">#</a> 与 script 标签的关系</h4> <ul><li>每个 script 的顶层代码都位于 Global 层（ECS 栈底）（无论是src引入脚本，还是内部代码）</li> <li>每个 script 都创建一套独立的完整的 Program 生命周期（创建 ESC -&gt; Global EC 流程），因此不同的 script 报错不会相互影响</li></ul> <h3 id="声明提升"><a href="#声明提升" class="header-anchor">#</a> 声明提升</h3> <p>引擎执行代码前会在预编译阶段进行声明提升</p> <ul><li>函数提升（function）
<ul><li>完全提升，<u>严格模式下只提升至块级作用域（若存在）</u></li> <li>若存在同名函数，则优先级为后面覆盖前面</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'函数a1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'函数a2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>变量提升（var）
<ul><li>部分提升至当前<u>最近的有效的</u>词法作用域，只提升声明部分，不提升赋值部分，初始化值为 <code>undefined</code></li> <li>若变量名与函数名重复，则以函数为准（因为变量提升之后为 <code>undefined</code> ，没有意义，引擎会默认打印有意义的值）</li> <li>若涉及 ES6 新语法：let、const、class，则报错 <code>SyntaxError: Identifier has already been defined</code></li></ul></li></ul> <h4 id="块级作用域"><a href="#块级作用域" class="header-anchor">#</a> 块级作用域</h4> <p>ES6 引入了块级作用域的概念，由一对大括号界定（<code>{}</code> 会被引擎优先解析为块级作用域而不是对象）</p> <ul><li>with（严格模式禁止，有变量指向歧义，避免使用，可以用解构代替）</li> <li>try catch</li> <li>for</li> <li>使用 const / let 声明变量对块级作用域有效</li></ul> <h4 id="块级作用域内的函数提升"><a href="#块级作用域内的函数提升" class="header-anchor">#</a> 块级作用域内的函数提升</h4> <ul><li>会提升<strong>整体</strong>到「块内」的顶部</li> <li>同时会提升<strong>变量声明</strong>至「块外」的顶部，类似于 <code>var</code> ，此时值为 <code>undefined</code></li> <li>提升至「块外」的变量，会 <u><strong>依照词法阶段的顺序在引擎执行到该函数声明时将当前「块内」该变量的值映射（link）至「块外」的变量</strong></u></li></ul> <p>因此会产生以下行为：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*       1 undefined undefined */</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: a is not a function</span>
<span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*   2 function a(){} undefined */</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 映射（link）当前该变量的值至块外作用域</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*       3 function a(){} function a(){} */</span>
</code></pre></div><h4 id="块级作用域内存在同名的函数和默认变量"><a href="#块级作用域内存在同名的函数和默认变量" class="header-anchor">#</a> 块级作用域内存在同名的函数和默认变量</h4> <p>PS : 默认变量 - 在没有声明的情况下直接向变量赋值，类似于 <code>a = 1;</code></p> <p>关注以下行为：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*       1 undefined undefined */</span>
<span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*   2 function a(){} undefined */</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 映射（link）当前该变量的值至块外作用域</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*   3 function a(){} function a(){} */</span>
    a <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token comment">// 此时只单纯的对块内的默认变量赋值，对块外的 window.a 无影响</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*   4 50 function a(){} */</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*       5 function a(){} fuction a(){} */</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*       1 undefined undefined */</span>
<span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*   2 function a(){} undefined */</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 映射（link）当前该变量的值至块外作用域</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*   3 function a(){} function a(){} */</span>
    a <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token comment">// 此时只单纯的对块内的默认变量赋值，对块外的 window.a 无影响</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*   4 50 function a(){} */</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 增加一个声明，再次映射（link）当前该变量的值至块外作用域</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*   5 50 50 */</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*       6 50 50 */</span>
</code></pre></div><h3 id="this"><a href="#this" class="header-anchor">#</a> this</h3> <p>JavaScript 的 <code>this</code> 机制为运行时动态绑定</p> <p>名词：</p> <ul><li><code>[[thisMode]]</code> - 私有属性，表示当前 <code>thisValue</code> 的查找规则，有三种取值
<ul><li>lexical - 从上下文中找 this（对应箭头函数）</li> <li>global - 当 this 为 undefined 时，取全局对象（对应普通函数调用）</li> <li>strict - 当严格模式时使用，this 严格按照调用时传入的值，可能为 null 或者 undefined（class 被设计成了默认按 strict 模式执行，可通过 call / apply 改写，对应对象方法调用）</li></ul></li> <li><code>[[ThisBindingStatus]]</code> - 私有属性，表示绑定在当前词法环境记录中的 this 指向</li></ul> <p>js运行时，引擎会根据 <code>[[thisMode]]</code> 来标记新纪录的 <code>[[ThisBindingStatus]]</code> 私有属性，引擎执行遇到 this 时，会逐层检查当前词法环境记录中的 <code>[[ThisBindingStatus]]</code>，当找到有 this 的环境记录时获取 this 的值</p> <ul><li>Global
<ul><li>脚本 - <code>window</code></li> <li>模块 - <code>module.exports</code></li></ul></li> <li>Function / Eval （会创建新的 EC ）
<ul><li>方法调用 - 调用的 <code>Object</code></li> <li>函数调用 - <code>window</code> <ul><li>严格模式 - <code>undefined</code></li></ul></li> <li>箭头函数 - 绑定父级的词法作用域的 this</li></ul></li></ul> <h3 id="严格模式"><a href="#严格模式" class="header-anchor">#</a> 严格模式</h3> <ul><li><code>'use strict';</code></li> <li>函数层面的严格</li></ul> <h2 id="语句"><a href="#语句" class="header-anchor">#</a> 语句</h2> <p>js 代码执行过程中，<strong>最细颗度</strong>的执行片段</p> <p>语句分类：</p> <ul><li><strong>普通语句</strong> <ul><li>声明类语句
<ul><li>var</li> <li>const</li> <li>let</li> <li>函数声明</li> <li>类声明</li></ul></li> <li>表达式语句</li> <li>空语句</li> <li>with语句</li> <li>debugger语句</li></ul></li> <li><strong>语句块</strong> <ul><li>大括号括起来的一组语句</li></ul></li> <li><strong>控制型语句</strong> <ul><li>if</li> <li>switch</li> <li>for
<ul><li>for</li> <li>for-of</li> <li>for-await-of</li> <li>for-in</li></ul></li> <li>while
<ul><li>while</li> <li>do-while</li></ul></li> <li>continue</li> <li>break</li> <li>return</li> <li>throw</li> <li>try</li></ul></li> <li><strong>带标签的语句</strong> <ul><li>语句前加冒号</li></ul></li></ul> <h3 id="completion-record-类型"><a href="#completion-record-类型" class="header-anchor">#</a> Completion Record 类型</h3> <p>Completion Record 表示 <strong>一个语句执行完之后的结果</strong>，有三个字段</p> <ul><li><code>[[type]]</code> - 表示完成的类型，有 <code>break</code> <code>continue</code> <code>return</code> <code>throw</code> 和 <code>normal</code> 几种类型
<ul><li><code>normal</code> - 引擎遇到会继续执行下一句</li></ul></li> <li><code>[[value]]</code> - 表示语句的返回值，如果语句没有，则是 empty</li> <li><code>[[target]]</code> - 表示语句的目标，通常是一个 JavaScript 标签</li></ul> <h3 id="普通语句"><a href="#普通语句" class="header-anchor">#</a> 普通语句</h3> <ul><li>顺序执行，得到 <code>[[type]]</code> 为 <code>normal</code> 的 Completion Record</li> <li>Chrome 控制台打印的普通语句执行结果即为 Completion Record 的 <code>[[value]]</code></li></ul> <h3 id="语句块"><a href="#语句块" class="header-anchor">#</a> 语句块</h3> <ul><li>大括号括起来的一组语句、多条语句</li> <li>一个语句块每条语句执行的 Completion Record <code>[[type]]</code> 都可能对整个语句块产生影响，若一条语句执行的 <code>[[type]]</code> 为
<ul><li><code>normal</code>，则继续顺序执行</li> <li>非 <code>normal</code> ，则会打断后续语句的执行，该语句执行得到的 Completion Record 即作为整个语句块执行的 Completion Record</li></ul></li></ul> <h3 id="控制型语句"><a href="#控制型语句" class="header-anchor">#</a> 控制型语句</h3> <ul><li>产生控制代码执行顺序和执行逻辑的效果</li> <li>又分为两类
<ul><li>对内部造成影响 - <code>if</code> 、<code>switch</code> 、<code>while/for</code> 、<code>try</code></li> <li>对外部造成影响 - <code>break</code> 、<code>continue</code> 、<code>return</code> 、<code>throw</code> <img src="/blog/img/js-excute/%E6%8E%A7%E5%88%B6%E5%9E%8B%E8%AF%AD%E5%8F%A5.png" alt="控制型语句"></li></ul></li></ul> <h3 id="带标签的语句"><a href="#带标签的语句" class="header-anchor">#</a> 带标签的语句</h3> <ul><li>语句前加冒号</li> <li>大部分时候用于注释</li> <li>与完成记录类型中的 target 相配合，用于跳出多层循环</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">12/21/2019, 11:39:15 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/FE-Foundation/前端基础/深入js对象.html" class="prev">
          深入js对象
        </a></span> <span class="next"><a href="/blog/FE-Foundation/%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81/">
          目录
        </a>
        →
      </span></p></div> </main> <!----> <div class="comments-wrapper" data-v-ad130a7c><!----></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-a81d141e data-v-a81d141e><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-a81d141e><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-a81d141e></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-a81d141e></path></svg></div></div></div>
    <script src="/blog/assets/js/app.49d49959.js" defer></script><script src="/blog/assets/js/3.66f9ff46.js" defer></script><script src="/blog/assets/js/1.0064e023.js" defer></script><script src="/blog/assets/js/18.d105b441.js" defer></script>
  </body>
</html>
